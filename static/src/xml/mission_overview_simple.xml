<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="transport_management.MissionOverviewSimple" owl="1">
        <div style="height: 100vh; display: flex; flex-direction: column; background: #f8f9fa;">
            
            <!-- Header -->
            <div style="background: white; border-bottom: 1px solid #dee2e6; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                <div style="display: flex; align-items: center; gap: 24px;">
                    <h2 style="margin: 0; color: #4a5d87; font-size: 1.4rem; font-weight: 600;">
                        <i class="fa fa-map me-2"/>Mission Overview Map
                    </h2>
                    <div style="display: flex; gap: 16px;">
                        <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; font-weight: 500; background: rgba(23, 162, 184, 0.1); color: #17a2b8; border: 1px solid rgba(23, 162, 184, 0.2);">
                            <i class="fa fa-check-circle"/>
                            <span>Confirmed: <t t-esc="getStatusSummary().confirmed"/></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; font-weight: 500; background: rgba(255, 193, 7, 0.1); color: #ffc107; border: 1px solid rgba(255, 193, 7, 0.2);">
                            <i class="fa fa-truck"/>
                            <span>In Progress: <t t-esc="getStatusSummary().inProgress"/></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; font-weight: 500; background: rgba(74, 93, 135, 0.1); color: #4a5d87; border: 1px solid rgba(74, 93, 135, 0.2);">
                            <i class="fa fa-list"/>
                            <span>Total: <t t-esc="getStatusSummary().total"/></span>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
                    <div t-if="state.lastUpdate" style="font-size: 0.8rem; color: #6c757d;">
                        Last updated: <t t-esc="state.lastUpdate.toLocaleTimeString()"/>
                    </div>
                    <button type="button" 
                            class="btn btn-outline-primary btn-sm" 
                            t-on-click="refreshMissions"
                            t-att-disabled="state.loading"
                            style="border-radius: 6px; font-weight: 500;">
                        <i class="fa fa-refresh" t-att-class="{'fa-spin': state.loading}"/>
                        <span t-if="!state.loading">Refresh</span>
                        <span t-else="">Loading...</span>
                    </button>
                </div>
            </div>

            <!-- Legend -->
            <div style="background: white; border-bottom: 1px solid #dee2e6; padding: 12px 24px; display: flex; gap: 32px;">
                <div>
                    <h6 style="margin: 0 0 8px 0; color: #4a5d87; font-size: 0.85rem; font-weight: 600;">Mission Types</h6>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">üè≠</span>
                            <span>Pickup Source</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">üì§</span>
                            <span>Pickup Destination</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">üì¶</span>
                            <span>Delivery Source</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">üì•</span>
                            <span>Delivery Destination</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h6 style="margin: 0 0 8px 0; color: #4a5d87; font-size: 0.85rem; font-weight: 600;">Mission Status</h6>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <div style="width: 30px; height: 3px; border-radius: 2px; background: #17a2b8; background-image: repeating-linear-gradient(45deg, transparent, transparent 3px, white 3px, white 6px);"></div>
                            <span>Confirmed (dashed)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <div style="width: 30px; height: 3px; border-radius: 2px; background: #ffc107;"></div>
                            <span>In Progress (solid)</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h6 style="margin: 0 0 8px 0; color: #4a5d87; font-size: 0.85rem; font-weight: 600;">Destination Status</h6>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">‚úÖ</span>
                            <span>Completed</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">‚è≥</span>
                            <span>Pending</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map Container -->
            <div style="flex: 1; position: relative; min-height: 400px;">
                <div t-ref="mapContainer" style="height: 100%; width: 100%;"></div>
                
                <!-- Floating Mission Panel -->
                <div t-if="!state.loading and state.missions.length" 
                     class="tm_floating_panel">
                    
                    <!-- Mission Header (similar to tm_mission_header) -->
                    <div class="tm_floating_header">
                        <div class="tm_title_section">
                            <h4 t-if="!state.selectedMission">
                                <i class="fa fa-list me-2"/>Active Missions 
                                <span class="badge badge-secondary"><t t-esc="state.missions.length"/></span>
                            </h4>
                            <h4 t-else="">
                                <i class="fa fa-info-circle me-2"/>Mission Details
                            </h4>
                        </div>
                        <div class="tm_panel_controls">
                            <button t-if="state.selectedMission" 
                                    type="button" 
                                    class="btn btn-sm btn-outline-light"
                                    t-on-click="deselectMission">
                                <i class="fa fa-arrow-left"/>
                            </button>
                            <button type="button" 
                                    class="btn btn-sm btn-outline-light"
                                    t-on-click="togglePanel">
                                <i class="fa fa-minus" t-if="!state.panelCollapsed"/>
                                <i class="fa fa-plus" t-else=""/>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Panel Content -->
                    <div t-if="!state.panelCollapsed" class="tm_floating_content">
                        
                        <!-- Mission List View -->
                        <div t-if="!state.selectedMission" class="tm_mission_list">
                            <t t-foreach="state.missions" t-as="mission" t-key="mission.id">
                                <div class="tm_mission_card" 
                                     t-att-class="'tm-state-' + mission.state"
                                     t-on-click="() => this.selectMission(mission)">
                                    
                                    <div class="tm_mission_card_header">
                                        <div class="tm_mission_name">
                                            <strong><t t-esc="mission.name"/></strong>
                                            <div class="tm_mission_type" t-att-class="'tm-type-' + mission.mission_type">
                                                <span t-if="mission.mission_type === 'pickup'">üì§ Pickup</span>
                                                <span t-else="">üì• Delivery</span>
                                            </div>
                                        </div>
                                        <div class="tm_mission_status" t-att-class="'tm-status-' + mission.state">
                                            <span t-if="mission.state === 'confirmed'">‚úÖ Confirmed</span>
                                            <span t-else="">üöõ In Progress</span>
                                        </div>
                                    </div>
                                    
                                    <div class="tm_mission_details">
                                        <div class="tm_detail_row">
                                            <i class="fa fa-map-marker"/>
                                            <span><t t-esc="mission.destinations.length"/> stops</span>
                                        </div>
                                        <div class="tm_detail_row">
                                            <i class="fa fa-route"/>
                                            <span><t t-esc="(mission.total_distance_km || 0).toFixed(1)"/> km</span>
                                        </div>
                                    </div>
                                    
                                    <div class="tm_progress_section">
                                        <div class="tm_progress_label">
                                            Progress: <t t-esc="(mission.destination_progress || 0).toFixed(0)"/>%
                                        </div>
                                        <div class="progress tm_progress_bar">
                                            <div class="progress-bar" 
                                                 t-att-style="'width: ' + (mission.destination_progress || 0) + '%;'"
                                                 t-att-class="mission.state === 'in_progress' ? 'bg-warning' : 'bg-info'">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                        
                        <!-- Mission Detail View -->
                        <div t-if="state.selectedMission" class="tm_details_form">
                            <!-- Mission Header -->
                            <div class="tm_form_section">
                                <div class="tm_mission_title">
                                    <h1><t t-esc="state.selectedMission.name"/></h1>
                                    <div class="tm_mission_type_badge">
                                        <span t-if="state.selectedMission.mission_type === 'pickup'" class="badge badge-info tm_pickup_badge">
                                            <i class="fa fa-arrow-up me-1"/>Pickup Mission
                                        </span>
                                        <span t-else="" class="badge badge-success tm_delivery_badge">
                                            <i class="fa fa-arrow-down me-1"/>Delivery Mission
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Metrics Grid -->
                                <div class="tm_metrics_grid">
                                    <div class="tm_metric_card">
                                        <div class="tm_metric_icon"><i class="fa fa-route"/></div>
                                        <div class="tm_metric_content">
                                            <span class="tm_metric_label">Total Distance</span>
                                            <div class="tm_metric_value">
                                                <span><t t-esc="(state.selectedMission.total_distance_km || 0).toFixed(1)"/> km</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tm_metric_card">
                                        <div class="tm_metric_icon"><i class="fa fa-tasks"/></div>
                                        <div class="tm_metric_content">
                                            <span class="tm_metric_label">Progress</span>
                                            <div class="progress" style="height: 20px;">
                                                <div class="progress-bar" role="progressbar" 
                                                     t-att-style="'width: ' + (state.selectedMission.destination_progress || 0) + '%;'" 
                                                     t-att-aria-valuenow="state.selectedMission.destination_progress || 0" 
                                                     aria-valuemin="0" aria-valuemax="100">
                                                    <t t-esc="(state.selectedMission.destination_progress || 0).toFixed(0)"/>%
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mission Configuration -->
                            <div class="tm_form_section">
                                <h4><i class="fa fa-info-circle me-2 text-info"/>Mission Information</h4>
                                <div class="tm_config_grid">
                                    <div class="tm_config_item">
                                        <label class="tm_config_label">Date</label>
                                        <div class="tm_config_value">
                                            <span><t t-esc="state.selectedMission.mission_date"/></span>
                                        </div>
                                    </div>
                                    <div class="tm_config_item">
                                        <label class="tm_config_label">Status</label>
                                        <div class="tm_config_value">
                                            <span t-if="state.selectedMission.state === 'confirmed'" class="badge badge-info">‚úÖ Confirmed</span>
                                            <span t-else="" class="badge badge-warning">üöõ In Progress</span>
                                        </div>
                                    </div>
                                    <div class="tm_config_item">
                                        <label class="tm_config_label">Driver</label>
                                        <div class="tm_config_value">
                                            <div class="tm_driver_display">
                                                <i class="fa fa-user me-2"/>
                                                <span><t t-esc="state.selectedMission.driver_id ? state.selectedMission.driver_id[1] : 'Not assigned'"/></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tm_config_item">
                                        <label class="tm_config_label">Vehicle</label>
                                        <div class="tm_config_value">
                                            <div class="tm_vehicle_display">
                                                <i class="fa fa-truck me-2"/>
                                                <span><t t-esc="state.selectedMission.vehicle_id ? state.selectedMission.vehicle_id[1] : 'Not assigned'"/></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Source Location -->
                            <div class="tm_form_section">
                                <h4><i class="fa fa-play-circle me-2 text-primary"/>Source Location</h4>
                                <div class="tm_location_display">
                                    <div class="tm_location_item tm_source_item">
                                        <i class="fa fa-map-marker-alt text-primary"/>
                                        <div class="tm_location_info">
                                            <span class="tm_location_address"><t t-esc="state.selectedMission.source_location || 'Location not specified'"/></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Destinations -->
                            <div class="tm_form_section">
                                <h4>
                                    <i class="fa fa-flag-checkered me-2 text-success"/>
                                    Destinations 
                                    <span class="badge badge-secondary"><t t-esc="state.selectedMission.destinations.length"/></span>
                                </h4>
                                <div class="tm_destinations_list">
                                    <t t-foreach="state.selectedMission.destinations" t-as="dest" t-key="dest.id">
                                        <div class="tm_location_item tm_destination_item">
                                            <div class="tm_destination_number"><t t-esc="dest.sequence"/></div>
                                            <div class="tm_location_info">
                                                <span class="tm_location_address"><t t-esc="dest.location"/></span>
                                            </div>
                                            <div class="tm_destination_status">
                                                <span t-if="dest.is_completed" class="text-success">‚úÖ</span>
                                                <span t-else="" class="text-warning">‚è≥</span>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Loading overlay -->
                <div t-if="state.loading" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.9); display: flex; align-items: center; justify-content: center; z-index: 1000;">
                    <div style="text-align: center; color: #4a5d87;">
                        <i class="fa fa-spinner fa-spin fa-2x" style="margin-bottom: 12px;"/>
                        <p style="margin: 0; font-weight: 500;">Loading missions...</p>
                    </div>
                </div>
                
                <!-- Empty state -->
                <div t-if="!state.loading and !state.missions.length" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; background: white;">
                    <div style="text-align: center; color: #6c757d;">
                        <i class="fa fa-map-o fa-3x" style="margin-bottom: 16px;"/>
                        <h4 style="margin-bottom: 8px; color: #4a5d87;">No Active Missions</h4>
                        <p style="margin: 0;">There are currently no confirmed or in-progress missions to display.</p>
                    </div>
                </div>
            </div>
        </div>
    </t>

</templates>