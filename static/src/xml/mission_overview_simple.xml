<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="transport_management.MissionOverviewSimple" owl="1">
        <div style="height: 100vh; display: flex; flex-direction: column; background: #f8f9fa;">
            
            <!-- Header -->
            <div style="background: white; border-bottom: 1px solid #dee2e6; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                <div style="display: flex; align-items: center; gap: 24px;">
                    <h2 style="margin: 0; color: #4a5d87; font-size: 1.4rem; font-weight: 600;">
                        <i class="fa fa-map me-2"/>Mission Overview Map
                    </h2>
                    <div style="display: flex; gap: 16px;">
                        <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; font-weight: 500; background: rgba(23, 162, 184, 0.1); color: #17a2b8; border: 1px solid rgba(23, 162, 184, 0.2);">
                            <i class="fa fa-check-circle"/>
                            <span>Confirmed: <t t-esc="getStatusSummary().confirmed"/></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; font-weight: 500; background: rgba(255, 193, 7, 0.1); color: #ffc107; border: 1px solid rgba(255, 193, 7, 0.2);">
                            <i class="fa fa-truck"/>
                            <span>In Progress: <t t-esc="getStatusSummary().inProgress"/></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; font-weight: 500; background: rgba(74, 93, 135, 0.1); color: #4a5d87; border: 1px solid rgba(74, 93, 135, 0.2);">
                            <i class="fa fa-list"/>
                            <span>Total: <t t-esc="getStatusSummary().total"/></span>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
                    <div t-if="state.lastUpdate" style="font-size: 0.8rem; color: #6c757d;">
                        Last updated: <t t-esc="state.lastUpdate.toLocaleTimeString()"/>
                    </div>
                    <button type="button" 
                            class="btn btn-outline-primary btn-sm" 
                            t-on-click="refreshMissions"
                            t-att-disabled="state.loading"
                            style="border-radius: 6px; font-weight: 500;">
                        <i class="fa fa-refresh" t-att-class="{'fa-spin': state.loading}"/>
                        <span t-if="!state.loading">Refresh</span>
                        <span t-else="">Loading...</span>
                    </button>
                </div>
            </div>

            <!-- Legend -->
            <div style="background: white; border-bottom: 1px solid #dee2e6; padding: 12px 24px; display: flex; gap: 32px;">
                <div>
                    <h6 style="margin: 0 0 8px 0; color: #4a5d87; font-size: 0.85rem; font-weight: 600;">Mission Types</h6>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">üè≠</span>
                            <span>Pickup Source</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">üì§</span>
                            <span>Pickup Destination</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">üì¶</span>
                            <span>Delivery Source</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">üì•</span>
                            <span>Delivery Destination</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h6 style="margin: 0 0 8px 0; color: #4a5d87; font-size: 0.85rem; font-weight: 600;">Mission Status</h6>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <div style="width: 30px; height: 3px; border-radius: 2px; background: #17a2b8; background-image: repeating-linear-gradient(45deg, transparent, transparent 3px, white 3px, white 6px);"></div>
                            <span>Confirmed (dashed)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <div style="width: 30px; height: 3px; border-radius: 2px; background: #ffc107;"></div>
                            <span>In Progress (solid)</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h6 style="margin: 0 0 8px 0; color: #4a5d87; font-size: 0.85rem; font-weight: 600;">Destination Status</h6>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">‚úÖ</span>
                            <span>Completed</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #6c757d;">
                            <span style="font-size: 1rem;">‚è≥</span>
                            <span>Pending</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map Container -->
            <div style="flex: 1; position: relative; min-height: 400px;">
                <div t-ref="mapContainer" style="height: 100%; width: 100%;"></div>
                
                <!-- Floating Mission Panel -->
                <div t-if="!state.loading and state.missions.length" 
                     style="position: absolute; top: 20px; right: 20px; width: 350px; max-height: calc(100% - 40px); background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; display: flex; flex-direction: column;">
                    
                    <!-- Panel Header -->
                    <div style="padding: 16px; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; background: #4a5d87; color: white; border-radius: 8px 8px 0 0;">
                        <h6 style="margin: 0; font-weight: 600;">
                            <span t-if="!state.selectedMission">Active Missions (<t t-esc="state.missions.length"/>)</span>
                            <span t-else="">Mission Details</span>
                        </h6>
                        <div style="display: flex; gap: 8px;">
                            <button t-if="state.selectedMission" 
                                    type="button" 
                                    t-on-click="deselectMission"
                                    style="background: none; border: none; color: white; cursor: pointer; padding: 4px;">
                                <i class="fa fa-arrow-left"/>
                            </button>
                            <button type="button" 
                                    t-on-click="togglePanel"
                                    style="background: none; border: none; color: white; cursor: pointer; padding: 4px;">
                                <i class="fa fa-minus" t-if="!state.panelCollapsed"/>
                                <i class="fa fa-plus" t-else=""/>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Panel Content -->
                    <div t-if="!state.panelCollapsed" style="flex: 1; overflow-y: auto; max-height: 500px;">
                        
                        <!-- Mission List View -->
                        <div t-if="!state.selectedMission" style="padding: 8px;">
                            <t t-foreach="state.missions" t-as="mission" t-key="mission.id">
                                <div t-on-click="() => this.selectMission(mission)"
                                     style="padding: 12px; margin-bottom: 8px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; transition: all 0.2s ease;"
                                     t-att-style="'border-left: 4px solid ' + (mission.state === 'in_progress' ? '#ffc107' : '#17a2b8') + ';'"
                                     onmouseover="this.style.backgroundColor='#f8f9fa'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';"
                                     onmouseout="this.style.backgroundColor='white'; this.style.transform='none'; this.style.boxShadow='none';">
                                    
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                        <div>
                                            <strong style="color: #4a5d87; font-size: 0.9rem;"><t t-esc="mission.name"/></strong>
                                            <div style="font-size: 0.75rem; color: #6c757d; margin-top: 2px;">
                                                <span t-if="mission.mission_type === 'pickup'" style="color: #17a2b8;">üì§ Pickup</span>
                                                <span t-else="" style="color: #28a745;">üì• Delivery</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; font-weight: 500;"
                                             t-att-style="'background: ' + (mission.state === 'in_progress' ? 'rgba(255, 193, 7, 0.1); color: #ffc107' : 'rgba(23, 162, 184, 0.1); color: #17a2b8') + ';'">
                                            <span t-if="mission.state === 'confirmed'">‚úÖ Confirmed</span>
                                            <span t-else="">üöõ In Progress</span>
                                        </div>
                                    </div>
                                    
                                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #6c757d;">
                                        <span><i class="fa fa-map-marker" style="margin-right: 4px;"/><t t-esc="mission.destinations.length"/> stops</span>
                                        <span><i class="fa fa-route" style="margin-right: 4px;"/><t t-esc="(mission.total_distance_km || 0).toFixed(1)"/> km</span>
                                    </div>
                                    
                                    <!-- Progress bar -->
                                    <div style="margin-top: 8px;">
                                        <div style="background: #f0f0f0; height: 4px; border-radius: 2px; overflow: hidden;">
                                            <div t-att-style="'background: ' + (mission.state === 'in_progress' ? '#ffc107' : '#17a2b8') + '; height: 100%; width: ' + (mission.destination_progress || 0) + '%; transition: width 0.3s ease;'"></div>
                                        </div>
                                        <div style="font-size: 0.7rem; color: #6c757d; margin-top: 2px; text-align: right;">
                                            <t t-esc="(mission.destination_progress || 0).toFixed(0)"/>% complete
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                        
                        <!-- Mission Detail View -->
                        <div t-if="state.selectedMission" style="padding: 16px;">
                            <div style="margin-bottom: 16px;">
                                <h5 style="margin: 0 0 8px 0; color: #4a5d87;"><t t-esc="state.selectedMission.name"/></h5>
                                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                                    <span style="font-size: 0.85rem; padding: 4px 8px; border-radius: 4px;"
                                          t-att-style="'background: ' + (state.selectedMission.mission_type === 'pickup' ? 'rgba(23, 162, 184, 0.1); color: #17a2b8' : 'rgba(40, 167, 69, 0.1); color: #28a745') + ';'">
                                        <span t-if="state.selectedMission.mission_type === 'pickup'">üì§ Pickup Mission</span>
                                        <span t-else="">üì• Delivery Mission</span>
                                    </span>
                                    <span style="font-size: 0.85rem; padding: 4px 8px; border-radius: 4px;"
                                          t-att-style="'background: ' + (state.selectedMission.state === 'in_progress' ? 'rgba(255, 193, 7, 0.1); color: #ffc107' : 'rgba(23, 162, 184, 0.1); color: #17a2b8') + ';'">
                                        <span t-if="state.selectedMission.state === 'confirmed'">‚úÖ Confirmed</span>
                                        <span t-else="">üöõ In Progress</span>
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Mission Info Grid -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; font-size: 0.85rem;">
                                <div>
                                    <strong style="color: #4a5d87;">Date:</strong><br/>
                                    <span><t t-esc="state.selectedMission.mission_date"/></span>
                                </div>
                                <div>
                                    <strong style="color: #4a5d87;">Distance:</strong><br/>
                                    <span><t t-esc="(state.selectedMission.total_distance_km || 0).toFixed(1)"/> km</span>
                                </div>
                                <div>
                                    <strong style="color: #4a5d87;">Driver:</strong><br/>
                                    <span><t t-esc="state.selectedMission.driver_id ? state.selectedMission.driver_id[1] : 'Not assigned'"/></span>
                                </div>
                                <div>
                                    <strong style="color: #4a5d87;">Vehicle:</strong><br/>
                                    <span><t t-esc="state.selectedMission.vehicle_id ? state.selectedMission.vehicle_id[1] : 'Not assigned'"/></span>
                                </div>
                            </div>
                            
                            <!-- Progress -->
                            <div style="margin-bottom: 16px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                    <strong style="color: #4a5d87; font-size: 0.85rem;">Progress:</strong>
                                    <span style="font-size: 0.8rem; color: #6c757d;"><t t-esc="(state.selectedMission.destination_progress || 0).toFixed(0)"/>%</span>
                                </div>
                                <div style="background: #f0f0f0; height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div t-att-style="'background: linear-gradient(90deg, #4a5d87, #17a2b8); height: 100%; width: ' + (state.selectedMission.destination_progress || 0) + '%; transition: width 0.3s ease;'"></div>
                                </div>
                            </div>
                            
                            <!-- Source Location -->
                            <div style="margin-bottom: 16px;">
                                <strong style="color: #4a5d87; font-size: 0.85rem; display: block; margin-bottom: 8px;">
                                    <i class="fa fa-play-circle" style="margin-right: 6px;"/>Source Location:
                                </strong>
                                <div style="padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 0.8rem;">
                                    <t t-esc="state.selectedMission.source_location || 'Location not specified'"/>
                                </div>
                            </div>
                            
                            <!-- Destinations -->
                            <div>
                                <strong style="color: #4a5d87; font-size: 0.85rem; display: block; margin-bottom: 8px;">
                                    <i class="fa fa-flag-checkered" style="margin-right: 6px;"/>Destinations (<t t-esc="state.selectedMission.destinations.length"/>):
                                </strong>
                                <div style="max-height: 200px; overflow-y: auto;">
                                    <t t-foreach="state.selectedMission.destinations" t-as="dest" t-key="dest.id">
                                        <div style="display: flex; align-items: center; padding: 6px 8px; margin-bottom: 4px; background: #f8f9fa; border-radius: 4px; font-size: 0.8rem;">
                                            <div style="width: 20px; height: 20px; border-radius: 50%; background: #4a5d87; color: white; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; margin-right: 8px; flex-shrink: 0;">
                                                <t t-esc="dest.sequence"/>
                                            </div>
                                            <div style="flex: 1; min-width: 0;">
                                                <div style="font-weight: 500; color: #4a5d87; margin-bottom: 2px;">
                                                    <t t-esc="dest.location"/>
                                                </div>
                                            </div>
                                            <div style="margin-left: 8px;">
                                                <span t-if="dest.is_completed" style="color: #28a745; font-size: 0.9rem;">‚úÖ</span>
                                                <span t-else="" style="color: #ffc107; font-size: 0.9rem;">‚è≥</span>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Loading overlay -->
                <div t-if="state.loading" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.9); display: flex; align-items: center; justify-content: center; z-index: 1000;">
                    <div style="text-align: center; color: #4a5d87;">
                        <i class="fa fa-spinner fa-spin fa-2x" style="margin-bottom: 12px;"/>
                        <p style="margin: 0; font-weight: 500;">Loading missions...</p>
                    </div>
                </div>
                
                <!-- Empty state -->
                <div t-if="!state.loading and !state.missions.length" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; background: white;">
                    <div style="text-align: center; color: #6c757d;">
                        <i class="fa fa-map-o fa-3x" style="margin-bottom: 16px;"/>
                        <h4 style="margin-bottom: 8px; color: #4a5d87;">No Active Missions</h4>
                        <p style="margin: 0;">There are currently no confirmed or in-progress missions to display.</p>
                    </div>
                </div>
            </div>
        </div>
    </t>

</templates>